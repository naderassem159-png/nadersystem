<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>إدارة حجوزات القاعات</title>

<style>
body{font-family:Arial;background:#0f172a;color:#fff;text-align:center;margin:0}
.header{background:#1e293b;padding:15px;font-size:20px;font-weight:bold}
.container{padding:15px}
input,select{width:90%;padding:10px;margin:5px 0;border-radius:8px;border:none}
button{padding:9px 16px;background:#2563eb;border:none;color:#fff;border-radius:8px;margin:6px 4px}
.secondary{background:#334155}
.delete{background:#dc2626}
.edit{background:#f59e0b}
.card{background:#1e293b;padding:10px;margin:10px auto;border-radius:10px;width:95%;text-align:right}
.total-box{background:#111827;padding:10px;margin:10px;border-radius:10px;font-weight:bold}
hr{border:0;border-top:1px solid #334155;margin:14px 0}
.hidden{display:none}

/* Calendar */
.calendar-controls{display:flex;gap:8px;justify-content:center;align-items:center;flex-wrap:wrap;margin:10px 0}
.calendar-controls select{width:auto;min-width:140px}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:10px 5px}
.weekday{font-size:12px;opacity:.85;padding:6px 0}
.day{background:#111827;border:1px solid #1f2937;border-radius:10px;padding:8px 6px;min-height:92px;cursor:pointer}
.day .num{font-weight:bold;font-size:14px;text-align:left;opacity:.95}
.halls-mini{display:grid;grid-template-columns:repeat(2,1fr);gap:5px;margin-top:6px}
.mini{border-radius:7px;padding:5px 4px;font-size:11px;background:#1f2937;border:1px solid #243244;text-align:center}
.mini.free{background:#1f2937}
.mini.booked-am{background:#2563eb}
.mini.booked-pm{background:#7c3aed}
.mini.booked-both{background:#dc2626}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;justify-content:center;align-items:center;padding:14px}
.modal .box{background:#0b1220;border:1px solid #1f2937;width:100%;max-width:520px;border-radius:14px;padding:12px;text-align:right;max-height:80vh;overflow:auto}
.modal .top{display:flex;justify-content:space-between;align-items:center;gap:10px}
.modal .close{background:#334155}
.small{font-size:12px;opacity:.85}
.badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;margin-left:6px;background:#334155}
.badge.am{background:#2563eb}
.badge.pm{background:#7c3aed}
</style>
</head>

<body>
<div class="header">إدارة حجوزات القاعات</div>

<div class="total-box">
إجمالي المتبقي: <span id="totalRemaining">0</span>
</div>

<div class="container">
  <button onclick="showList()">قائمة الحجوزات</button>
  <button class="secondary" onclick="showCalendar()">التقويم</button>
</div>

<div class="container" id="listView">

  <select id="hall">
    <option value="">اختر القاعة</option>
    <option>قاعة كابيتال</option>
    <option>قاعة برادايس</option>
    <option>قاعة سكاي</option>
    <option>قاعة الماسة</option>
  </select>

  <input type="date" id="date" />

  <select id="period">
    <option value="">اختر الفترة</option>
    <option>صباحية</option>
    <option>مسائية</option>
  </select>

  <input type="text" id="name" placeholder="اسم العميل" />
  <input type="text" id="phone" placeholder="رقم الهاتف" />
  <input type="number" id="total" placeholder="قيمة الحجز" />
  <input type="number" id="paid" placeholder="العربون" />

  <button onclick="addBooking()">إضافة / تعديل حجز</button>

  <hr />

  <input type="date" id="filterDate" onchange="displayBookings()" />
  <input type="text" id="searchName" onkeyup="displayBookings()" placeholder="بحث باسم العميل" />

  <div id="bookings"></div>
</div>

<div class="container hidden" id="calendarView">
  <div class="calendar-controls">
    <select id="calMonth"></select>
    <select id="calYear"></select>
    <button class="secondary" onclick="renderCalendar(true)">عرض</button>
  </div>

  <div class="calendar-grid" id="weekdays"></div>
  <div class="calendar-grid" id="calendarGrid"></div>
</div>

<div class="modal" id="modal">
  <div class="box">
    <div class="top">
      <div>
        <div id="modalTitle" style="font-weight:bold">تفاصيل اليوم</div>
        <div class="small" id="modalSub"></div>
      </div>
      <button class="close" onclick="closeModal()">إغلاق</button>
    </div>
    <div id="modalBody" style="margin-top:10px;"></div>
  </div>
</div>

<script>
const HALLS = ["قاعة كابيتال","قاعة برادايس","قاعة سكاي","قاعة الماسة"];
let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
let editIndex = null;

function showList(){
  document.getElementById("listView").classList.remove("hidden");
  document.getElementById("calendarView").classList.add("hidden");
}

function showCalendar(){
  document.getElementById("calendarView").classList.remove("hidden");
  document.getElementById("listView").classList.add("hidden");
  renderCalendar(true);
}

function addBooking(){
  const hall = document.getElementById("hall").value;
  const date = document.getElementById("date").value;
  const period = document.getElementById("period").value;
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const total = Number(document.getElementById("total").value);
  const paid = Number(document.getElementById("paid").value);
  const remaining = total - paid;

  if(!hall || !date || !
